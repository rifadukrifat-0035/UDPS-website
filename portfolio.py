import streamlit as st
import pandas as pd
import plotly.express as px
import folium
from streamlit_folium import st_folium
from streamlit_extras.card import card
from streamlit_image_comparison import image_comparison
import json

# ---------------------------------------------------------
# ‡ßß. ‡¶π‡ßá‡¶°‡¶æ‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶á‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã
# ---------------------------------------------------------
st.header("Our Portfolio: Case Studies")
st.markdown("‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ-‡¶ö‡¶æ‡¶≤‡¶ø‡¶§ ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶®‡¶ó‡ßÅ‡¶≤‡¶ø ‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá ‡¶¨‡¶æ‡¶∏‡ßç‡¶§‡¶¨-‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡ßá‡¶∞ ‡¶∂‡¶π‡ßÅ‡¶∞‡ßá ‡¶ö‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶û‡ßç‡¶ú‡¶ó‡ßÅ‡¶≤‡¶ø ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶® ‡¶ï‡¶∞‡ßá‡¶õ‡ßá ‡¶§‡¶æ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®‡•§")

st.markdown("### Project Showcase")

# ---------------------------------------------------------
# ‡ß®. ‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶æ‡¶∞‡ßç‡¶° ‡¶∏‡ßá‡¶ï‡¶∂‡¶®
# ---------------------------------------------------------
col1, col2 = st.columns(2)

with col1:
    card(
        title="‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü: ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡¶ø‡¶ü ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ",
        text="‡¶∂‡¶π‡¶∞‡ßá‡¶∞ ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶´‡¶ø‡¶ï ‡¶™‡ßç‡¶∞‡¶¨‡¶æ‡¶π ‡¶Ö‡¶™‡ßç‡¶ü‡¶ø‡¶Æ‡¶æ‡¶á‡¶ú ‡¶ï‡¶∞‡¶§‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶æ‡¶∏ ‡¶∞‡ßÅ‡¶ü ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ‡ßá‡¶∞ ‡¶Æ‡¶°‡ßá‡¶≤‡¶ø‡¶Ç‡•§",
        image="https://images.unsplash.com/photo-1570125909232-eb263c188f7e?q=80&w=1000&auto=format&fit=crop",
        url="#"
    )

with col2:
    card(
        title="‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü: ‡¶ó‡ßç‡¶∞‡¶ø‡¶® ‡¶∏‡ßç‡¶™‡ßá‡¶∏ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶≤‡¶æ‡¶á‡¶∏‡¶ø‡¶∏",
        text="‡¶ú‡¶®‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶ò‡¶®‡¶§‡ßç‡¶¨ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∞‡ßç‡¶ï ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶¨‡ßÅ‡¶ú ‡¶∏‡ßç‡¶•‡¶æ‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶§‡ßç‡¶§‡¶Æ ‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶∏‡¶®‡¶æ‡¶ï‡ßç‡¶§‡¶ï‡¶∞‡¶£‡•§",
        image="https://images.unsplash.com/photo-1496568813655-eb5e63354007?q=80&w=1000&auto=format&fit=crop",
        url="#"
    )

st.markdown("---")

# ---------------------------------------------------------
# ‡ß©. ‡¶á‡¶Æ‡ßá‡¶ú ‡¶ï‡¶Æ‡ßç‡¶™‡¶æ‡¶∞‡¶ø‡¶ú‡¶® (‡¶¨‡¶ø‡¶´‡ßã‡¶∞/‡¶Ü‡¶´‡¶ü‡¶æ‡¶∞)
# ---------------------------------------------------------
st.subheader("‡¶ï‡ßá‡¶∏ ‡¶∏‡ßç‡¶ü‡¶æ‡¶°‡¶ø: ‡¶Ü‡¶∞‡¶¨‡¶æ‡¶® ‡¶∞‡¶ø‡¶®‡¶ø‡¶â‡¶Ø‡¶º‡¶æ‡¶≤ (‡¶Ü‡¶ó‡ßá ‡¶ì ‡¶™‡¶∞‡ßá)")
st.write("‡¶∏‡ßç‡¶Ø‡¶æ‡¶ü‡ßá‡¶≤‡¶æ‡¶á‡¶ü ‡¶á‡¶Æ‡ßá‡¶ú ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶ó‡¶§ ‡ß´ ‡¶¨‡¶õ‡¶∞‡ßá ‡¶∂‡¶π‡ßÅ‡¶∞‡ßá ‡¶∏‡¶¨‡ßÅ‡¶ú‡¶æ‡¶Ø‡¶º‡¶®‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶≠‡¶æ‡¶¨‡•§")

try:
    # ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶ñ‡ßã‡¶Å‡¶ú‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ
    image_comparison(
        img1="assets/before_development.png",
        img2="assets/after_development.png",
        label1="2019 (Before)",
        label2="2024 (After)",
        width=700  # [FIXED] use_container_width ‡¶è‡¶∞ ‡¶¨‡¶¶‡¶≤‡ßá width ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá
    )
except:
    # ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶°‡ßá‡¶Æ‡ßã
    st.info("‚ÑπÔ∏è ‡¶°‡ßá‡¶Æ‡ßã ‡¶Æ‡ßã‡¶°: ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶á‡¶Æ‡ßá‡¶ú ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§")
    image_comparison(
        img1="https://www.webfx.com/blog/images/cdn/cdn-original.jpg",
        img2="https://www.webfx.com/blog/images/cdn/cdn-optimized.jpg",
        label1="Original Image",
        label2="Processed Image",
        width=700  # [FIXED] ‡¶è‡¶ñ‡¶æ‡¶®‡ßá‡¶ì width ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá
    )

st.markdown("---")

# ---------------------------------------------------------
# ‡ß™. GIS ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™ ‡¶∏‡ßá‡¶ï‡¶∂‡¶® (Folium)
# ---------------------------------------------------------
st.subheader("‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡ßá‡¶ï‡ßç‡¶ü‡¶ø‡¶≠ GIS ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™: ‡¶ú‡ßã‡¶®‡¶ø‡¶Ç ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶≤‡¶æ‡¶á‡¶∏‡¶ø‡¶∏")
st.write("‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶ú‡ßã‡¶®‡¶ø‡¶Ç ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® (‡¶°‡ßá‡¶Æ‡ßã)‡•§")

# ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™ ‡¶§‡ßà‡¶∞‡¶ø (‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶®: ‡¶®‡¶ø‡¶â ‡¶á‡¶Ø‡¶º‡¶∞‡ßç‡¶ï)
m = folium.Map(location=[40.7128, -74.0060], zoom_start=12)

# GeoJSON ‡¶≤‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ
try:
    with open('assets/zoning.geojson') as f:
        geojson_data = json.load(f)
    
    folium.GeoJson(
        geojson_data,
        name="Zoning Districts",
        popup=folium.GeoJsonPopup(fields=["zone_type"], aliases=["Zone: "]) 
    ).add_to(m)
except:
    pass # ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞ ‡¶®‡ßá‡¶á, ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá

# ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó
folium.Marker(
    [40.7128, -74.0060], 
    popup="‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡¶æ‡¶¨‡¶ø‡¶§ ‡¶°‡ßá‡¶≠‡ßá‡¶≤‡¶™‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ú‡ßã‡¶® A", 
    tooltip="Zone A"
).add_to(m)

# Streamlit-‡¶è ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶™ ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞
# ‡¶®‡ßã‡¶ü: ‡¶è‡¶ñ‡¶æ‡¶®‡ßá use_container_width=True ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶¶ ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶è‡¶ü‡¶æ st_folium ‡¶è‡¶∞ ‡¶Ö‡¶Ç‡¶∂
map_data = st_folium(m, width=700, height=500, use_container_width=True)

if map_data and map_data.get('last_object_clicked_popup'):
    st.write(f"üìç ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®: **{map_data['last_object_clicked_popup']}**")

st.markdown("---")

# ---------------------------------------------------------
# ‡ß´. ‡¶°‡ßá‡¶ü‡¶æ ‡¶≠‡¶ø‡¶ú‡ßç‡¶Ø‡ßÅ‡¶Ø‡¶º‡¶æ‡¶≤‡¶æ‡¶á‡¶ú‡ßá‡¶∂‡¶® (Plotly Chart)
# ---------------------------------------------------------
st.subheader("‡¶°‡ßá‡¶Æ‡ßã‡¶ó‡ßç‡¶∞‡¶æ‡¶´‡¶ø‡¶ï ‡¶ü‡ßç‡¶∞‡ßá‡¶®‡ßç‡¶° ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶≤‡¶æ‡¶á‡¶∏‡¶ø‡¶∏")

# ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï
try:
    # ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá CSV ‡¶ñ‡ßã‡¶Å‡¶ú‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ
    df = pd.read_csv("assets/population_data.csv")
except:
    # CSV ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶°‡¶æ‡¶Æ‡¶ø ‡¶°‡ßá‡¶ü‡¶æ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ
    st.info("‚ÑπÔ∏è ‡¶°‡ßá‡¶Æ‡ßã ‡¶°‡ßá‡¶ü‡¶æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá (CSV ‡¶´‡¶æ‡¶á‡¶≤ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø)‡•§")
    data = {
        "Year": [2019, 2020, 2021, 2022, 2023] * 3,
        "District": ["Zone A"]*5 + ["Zone B"]*5 + ["Zone C"]*5,
        "Population": [1000, 1200, 1500, 1800, 2200, 
                       800, 900, 950, 1100, 1300,
                       2000, 1900, 1850, 1800, 1750]
    }
    df = pd.DataFrame(data)

# ‡¶ö‡¶æ‡¶∞‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø
fig = px.line(df, x="Year", y="Population", color="District", 
              title="‡¶ó‡¶§ ‡ß´ ‡¶¨‡¶õ‡¶∞‡ßá ‡¶¨‡¶ø‡¶≠‡¶ø‡¶®‡ßç‡¶® ‡¶ú‡ßã‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶¨‡ßÉ‡¶¶‡ßç‡¶ß‡¶ø", markers=True)

st.plotly_chart(fig, use_container_width=True)